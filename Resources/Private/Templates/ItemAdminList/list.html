<extlist:comment>
<!--  
Template for rendering an album.

Here is a list of objects / variables that can be accessed in this template:

Tx_PtExtlist_Domain_Model_List_ListData listData               List of items in album

@package YAG
@author Daniel Lienert <daniel@lienert.cc>
@author Michael Knoll <mimi@kaktusteam.de>
-->
</extlist:comment>


<script type="text/javascript">
{pageIdVar}
var del_url = 'index.php?id=' + pageId + '&tx_yag_pi1[controller]=Ajax&tx_yag_pi1[action]=deleteItem';
var key_url = 'index.php?id=' + pageId + '&tx_yag_pi1[controller]=Ajax&tx_yag_pi1[action]=setItemAsAlbumThumb';
        

    // Tastatureingaben
    $(document.documentElement).keyup(function (event) {
        // Eingabe per ESC schlie§en
        if (event.keyCode == 27) {
            $(".photo-detail-name").slideUp('fast');
            $(".photo-detail-description").hide();
            $(".photo-detail").css("z-index","10");
            $("#change-topic-input").hide();
            $("#change-topic-text").show();
        } 
    });
    
    $(function() {
        $('#change-topic').click(function() {
            $("#change-topic-text").hide();
            $("#change-topic-input").show();
            $("#focus").select();
        });
        
        $(".photo-detail-text").click(function () {
            $(this).parents("div.photo-detail").children(".photo-detail-name").show();
        });
        
        $(".photo-detail-name-cancel").click(function () {
            $(this).parents(".photo-detail-name").hide();
        });
        
        $("a.photo-detail-linkbar-description").click(function () {
              $(this).parents("div.photo-detail").children(".photo-detail-description").show();
              $(this).parents("div.photo-detail").css("z-index","50");
        });
        
        $(".photo-detail-description-cancel").click(function () {
            $(this).parents(".photo-detail-description").hide();
            $(this).parents("div.photo-detail").css("z-index","10");
        });
        
        // blend linkbar in and out on mouseover
        $(".photo-detail-photo").mouseover(function() {
            $(this).children(".photo-detail-linkbar").show();
        });
        $(".photo-detail-photo").mouseout(function() {
            $(this).children(".photo-detail-linkbar").hide();
        });

        $("#sortable").sortable({  
            //handle: 'div.photo-overview',
            update : function () {
              var order = $('#sortable').sortable('serialize');
                $.ajax({
                      url: "/config_galleries/sort_photos/",
                      type: "POST",
                      data: order,
                      // complete: function(){},
                      success: function(feedback){ $("#messages").html(feedback); }
                      // error: function(){}
                });
            }
          });

        $("a.photo-detail-linkbar-delete").click(function () {
            var photo = $(this).parents(".photo-detail");
            $.ajax({
                url: del_url,
                // we use id of photo div and cut off leading "imageUid-"
                data: "tx_yag_pi1[itemUid]="+photo.attr("id").substring(9), 
                success: function(feedback) {
                    if(feedback=='OK') {
                        $("#messages").html("<div class='message_ok'>Foto gel&ouml;scht</div>");
                        photo.fadeOut();
                    }else{
                        $("#messages").html("<div class='message_error'>"+feedback+"</div>");
                    }
                }
            });
        });
        
        $("a.photo-detail-linkbar-key").click(function () {
            var photo = $(this).parents(".photo-detail");
            $.ajax({
                url: key_url,
                // we use id of photo div and cut off leading "imageUid-"
                data: "tx_yag_pi1[itemUid]="+photo.attr("id").substring(9), 
                success: function(feedback) {
                    if(feedback=='OK') {
                        $("#messages").html("<div class='message_ok'>Foto als Album Thumbnail festgelegt!</div>");
                    }else{
                        $("#messages").html("<div class='message_error'>"+feedback+"</div>");
                    }
                }
            });
        });
    });  
</script>


<div class="config-fotos">
    <div id="sortable" class="ui-sortable">
		<f:for each="{listData}" key="rowIndex" as="listRow">		
		    <f:render partial="{config.itemListConfig.imageAdminThumbPartial}" arguments="{columnRelativeWidth: config.itemListConfig.columnRelativeWidth, image: listRow.image.value, rowIndex: listRow.specialValues.absoluteRowIndex, pager: pager, pagerCollection:pagerCollection}" />
		</f:for>	
	</div>
</div>


<div style="clear:both;">&nbsp;</div>
<div class="tx-yag-pager">
	<f:render partial="Pager" arguments="{pager: pager, pagerCollection: pagerCollection, itemsText: 'images'}" />
</div>